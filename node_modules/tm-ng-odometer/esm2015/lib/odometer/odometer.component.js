// tslint:disable-next-line: no-reference
///<reference path="odometer.d.ts" />
import { __decorate } from "tslib";
/**
 * Updated by Marco Trinastich on 03.31.20
 * Created by Jose Andres on 6.15.17
 */
import * as lodash from 'lodash';
import { Component, ViewEncapsulation, Input, ViewChild, ElementRef } from '@angular/core';
import { TmNgOdometerConfig } from './odometer.config';
import { CAR_THEME, DEFAULT_THEME, DIGITAL_THEME, MINIMAL_THEME, PLAZA_THEME, SLOT_MACHINE_THEME, TRAIN_STATION_THEME, } from './themes';
// Tm-Odometer / fixed version of the original HubSpot's Odometer
// https://github.com/HubSpot/odometer
const Odometer = require('tm-odometer');
let TmNgOdometerComponent = class TmNgOdometerComponent {
    constructor() {
        this.config = {};
        this.observable = undefined;
        // Individual configuration attributes
        this.animation = undefined;
        this.format = undefined;
        this.theme = undefined;
        this.value = undefined;
        this.duration = undefined;
        this.auto = undefined;
        // Available themes
        this.themes = [
            'car',
            'default',
            'digital',
            'minimal',
            'plaza',
            'slot-machine',
            'train-station'
        ];
    }
    // Start Odometer
    initOdometer() {
        if (!lodash.isUndefined(this.container)
            && typeof Odometer !== 'undefined') {
            this.odometer = new Odometer({
                el: this.container.nativeElement,
                animation: this.config.animation,
                value: this.config.value,
                duration: this.config.duration,
                format: this.config.format,
                theme: this.config.theme,
            });
            if (!lodash.isUndefined(this.number) && this.config.auto) {
                this.odometer.update(this.number);
            }
        }
    }
    initConfig() {
        this.config = lodash.defaults(this.config, new TmNgOdometerConfig());
        // Animation
        if (!lodash.isUndefined(this.animation)) {
            this.config.animation = this.animation;
        }
        // Format
        if (!lodash.isUndefined(this.format)) {
            this.config.format = this.format;
        }
        // Theme
        if (!lodash.isUndefined(this.theme)) {
            this.config.theme = !lodash.includes(this.themes, this.theme) ? 'default' : this.theme;
        }
        // Value
        if (!lodash.isUndefined(this.value)) {
            this.config.value = this.value;
        }
        // Duration
        if (!lodash.isUndefined(this.duration)) {
            this.config.duration = this.duration;
        }
        // Auto
        if (!lodash.isUndefined(this.auto)) {
            this.config.auto = this.auto;
        }
        // Validate theme. If not part of the
        // available themes array, use the default
        if (!lodash.includes(this.themes, this.config.theme)) {
            this.config.theme = 'default';
        }
    }
    // ***************************************
    //  LIFECYCLES
    // ***************************************
    ngOnInit() {
        // Bind Observable
        if (!lodash.isUndefined(this.observable) && !this.config.auto) {
            this.subscription = this.observable.subscribe((trigger) => {
                if (!lodash.isUndefined(trigger) && trigger) {
                    this.odometer.update(this.number);
                }
            });
        }
        // Apply defaults and
        // individual configurations
        this.initConfig();
    }
    ngOnDestroy() {
        if (!lodash.isUndefined(this.subscription)) {
            this.subscription.unsubscribe();
        }
    }
    ngOnChanges() {
        if (!lodash.isUndefined(this.number) && !lodash.isUndefined(this.odometer) && this.config.auto) {
            this.odometer.update(this.number);
        }
    }
    ngAfterViewInit() {
        this.initOdometer();
    }
};
__decorate([
    ViewChild('container', { read: ElementRef, static: true })
], TmNgOdometerComponent.prototype, "container", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "number", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "config", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "observable", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "animation", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "format", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "theme", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "value", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "duration", void 0);
__decorate([
    Input()
], TmNgOdometerComponent.prototype, "auto", void 0);
TmNgOdometerComponent = __decorate([
    Component({
        // tslint:disable-next-line: component-selector
        selector: 'tm-ng-odometer',
        encapsulation: ViewEncapsulation.None,
        template: `<div #container></div>`,
        styles: [CAR_THEME,
            DEFAULT_THEME,
            DIGITAL_THEME,
            MINIMAL_THEME,
            PLAZA_THEME,
            SLOT_MACHINE_THEME,
            TRAIN_STATION_THEME,
            `
            .odometer,
            .odometer-inside,
            .odometer-digit,
            .odometer-digit-spacer,
            .odometer-digit-inner,
            .odometer-ribbon,
            .odometer-ribbon-inner,
            .odometer-value,
            .odometer-formatting-mark {
                color: inherit;
                font-size: inherit;
                font-family: inherit;
            }
        `]
    })
], TmNgOdometerComponent);
export { TmNgOdometerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2RvbWV0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vdG0tbmctb2RvbWV0ZXIvIiwic291cmNlcyI6WyJsaWIvb2RvbWV0ZXIvb2RvbWV0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHlDQUF5QztBQUN6QyxxQ0FBcUM7O0FBRXJDOzs7R0FHRztBQUVILE9BQU8sS0FBSyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsS0FBSyxFQUNoQixTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3pFLE9BQU8sRUFBRSxrQkFBa0IsRUFBMkIsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRixPQUFPLEVBQ0gsU0FBUyxFQUNULGFBQWEsRUFDYixhQUFhLEVBQ2IsYUFBYSxFQUNiLFdBQVcsRUFDWCxrQkFBa0IsRUFDbEIsbUJBQW1CLEdBQ3JCLE1BQU0sVUFBVSxDQUFDO0FBRW5CLGlFQUFpRTtBQUNqRSxzQ0FBc0M7QUFDdEMsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBZ0N4QyxJQUFhLHFCQUFxQixHQUFsQyxNQUFhLHFCQUFxQjtJQUFsQztRQUthLFdBQU0sR0FBNEIsRUFBRSxDQUFDO1FBQ3JDLGVBQVUsR0FBd0IsU0FBUyxDQUFDO1FBRXJELHNDQUFzQztRQUM3QixjQUFTLEdBQVcsU0FBUyxDQUFDO1FBQzlCLFdBQU0sR0FBVyxTQUFTLENBQUM7UUFDM0IsVUFBSyxHQUFXLFNBQVMsQ0FBQztRQUMxQixVQUFLLEdBQVcsU0FBUyxDQUFDO1FBQzFCLGFBQVEsR0FBVyxTQUFTLENBQUM7UUFDN0IsU0FBSSxHQUFZLFNBQVMsQ0FBQztRQUVuQyxtQkFBbUI7UUFDWCxXQUFNLEdBQWtCO1lBQzVCLEtBQUs7WUFDTCxTQUFTO1lBQ1QsU0FBUztZQUNULFNBQVM7WUFDVCxPQUFPO1lBQ1AsY0FBYztZQUNkLGVBQWU7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RUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO3dEQUF1QjtBQUN6RTtJQUFSLEtBQUssRUFBRTtxREFBZ0I7QUFDZjtJQUFSLEtBQUssRUFBRTtxREFBc0M7QUFDckM7SUFBUixLQUFLLEVBQUU7eURBQTZDO0FBRzVDO0lBQVIsS0FBSyxFQUFFO3dEQUErQjtBQUM5QjtJQUFSLEtBQUssRUFBRTtxREFBNEI7QUFDM0I7SUFBUixLQUFLLEVBQUU7b0RBQTJCO0FBQzFCO0lBQVIsS0FBSyxFQUFFO29EQUEyQjtBQUMxQjtJQUFSLEtBQUssRUFBRTt1REFBOEI7QUFDN0I7SUFBUixLQUFLLEVBQUU7bURBQTJCO0FBZDFCLHFCQUFxQjtJQTlCakMsU0FBUyxDQUFDO1FBQ1AsK0NBQStDO1FBQy9DLFFBQVEsRUFBRSxnQkFBZ0I7UUFDMUIsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7UUF5QnJDLFFBQVEsRUFBRSx3QkFBd0I7aUJBdkI5QixTQUFTO1lBQ1QsYUFBYTtZQUNiLGFBQWE7WUFDYixhQUFhO1lBQ2IsV0FBVztZQUNYLGtCQUFrQjtZQUNsQixtQkFBbUI7WUFDbkI7Ozs7Ozs7Ozs7Ozs7O1NBY0M7S0FHUixDQUFDO0dBQ1cscUJBQXFCLENBMEhqQztTQTFIWSxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLXJlZmVyZW5jZVxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCJvZG9tZXRlci5kLnRzXCIgLz5cclxuXHJcbi8qKlxyXG4gKiBVcGRhdGVkIGJ5IE1hcmNvIFRyaW5hc3RpY2ggb24gMDMuMzEuMjBcclxuICogQ3JlYXRlZCBieSBKb3NlIEFuZHJlcyBvbiA2LjE1LjE3XHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgbG9kYXNoIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCB7IENvbXBvbmVudCwgVmlld0VuY2Fwc3VsYXRpb24sIElucHV0LCBPbkluaXQsIE9uRGVzdHJveSxcclxuICBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgT2RvbWV0ZXJNb2RlbCB9IGZyb20gJy4vb2RvbWV0ZXIubW9kZWwnO1xyXG5pbXBvcnQgeyBUbU5nT2RvbWV0ZXJDb25maWcsIFRtTmdPZG9tZXRlckNvbmZpZ01vZGVsIH0gZnJvbSAnLi9vZG9tZXRlci5jb25maWcnO1xyXG5pbXBvcnQge1xyXG4gICAgQ0FSX1RIRU1FLFxyXG4gICAgREVGQVVMVF9USEVNRSxcclxuICAgIERJR0lUQUxfVEhFTUUsXHJcbiAgICBNSU5JTUFMX1RIRU1FLFxyXG4gICAgUExBWkFfVEhFTUUsXHJcbiAgICBTTE9UX01BQ0hJTkVfVEhFTUUsXHJcbiAgICBUUkFJTl9TVEFUSU9OX1RIRU1FLFxyXG4gfSBmcm9tICcuL3RoZW1lcyc7XHJcblxyXG4vLyBUbS1PZG9tZXRlciAvIGZpeGVkIHZlcnNpb24gb2YgdGhlIG9yaWdpbmFsIEh1YlNwb3QncyBPZG9tZXRlclxyXG4vLyBodHRwczovL2dpdGh1Yi5jb20vSHViU3BvdC9vZG9tZXRlclxyXG5jb25zdCBPZG9tZXRlciA9IHJlcXVpcmUoJ3RtLW9kb21ldGVyJyk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogY29tcG9uZW50LXNlbGVjdG9yXHJcbiAgICBzZWxlY3RvcjogJ3RtLW5nLW9kb21ldGVyJyxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgICBzdHlsZXM6IFtcclxuICAgICAgICBDQVJfVEhFTUUsXHJcbiAgICAgICAgREVGQVVMVF9USEVNRSxcclxuICAgICAgICBESUdJVEFMX1RIRU1FLFxyXG4gICAgICAgIE1JTklNQUxfVEhFTUUsXHJcbiAgICAgICAgUExBWkFfVEhFTUUsXHJcbiAgICAgICAgU0xPVF9NQUNISU5FX1RIRU1FLFxyXG4gICAgICAgIFRSQUlOX1NUQVRJT05fVEhFTUUsXHJcbiAgICAgICAgYFxyXG4gICAgICAgICAgICAub2RvbWV0ZXIsXHJcbiAgICAgICAgICAgIC5vZG9tZXRlci1pbnNpZGUsXHJcbiAgICAgICAgICAgIC5vZG9tZXRlci1kaWdpdCxcclxuICAgICAgICAgICAgLm9kb21ldGVyLWRpZ2l0LXNwYWNlcixcclxuICAgICAgICAgICAgLm9kb21ldGVyLWRpZ2l0LWlubmVyLFxyXG4gICAgICAgICAgICAub2RvbWV0ZXItcmliYm9uLFxyXG4gICAgICAgICAgICAub2RvbWV0ZXItcmliYm9uLWlubmVyLFxyXG4gICAgICAgICAgICAub2RvbWV0ZXItdmFsdWUsXHJcbiAgICAgICAgICAgIC5vZG9tZXRlci1mb3JtYXR0aW5nLW1hcmsge1xyXG4gICAgICAgICAgICAgICAgY29sb3I6IGluaGVyaXQ7XHJcbiAgICAgICAgICAgICAgICBmb250LXNpemU6IGluaGVyaXQ7XHJcbiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogaW5oZXJpdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIGAsXHJcbiAgICBdLFxyXG4gICAgdGVtcGxhdGU6IGA8ZGl2ICNjb250YWluZXI+PC9kaXY+YFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVG1OZ09kb21ldGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgICBwcml2YXRlIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBvZG9tZXRlcjogT2RvbWV0ZXJNb2RlbDtcclxuICAgIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGNvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICAgIEBJbnB1dCgpIG51bWJlcjogbnVtYmVyOyAvLyBSZXF1aXJlZFxyXG4gICAgQElucHV0KCkgY29uZmlnOiBUbU5nT2RvbWV0ZXJDb25maWdNb2RlbCA9IHt9O1xyXG4gICAgQElucHV0KCkgb2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAvLyBJbmRpdmlkdWFsIGNvbmZpZ3VyYXRpb24gYXR0cmlidXRlc1xyXG4gICAgQElucHV0KCkgYW5pbWF0aW9uOiBzdHJpbmcgPSB1bmRlZmluZWQ7XHJcbiAgICBASW5wdXQoKSBmb3JtYXQ6IHN0cmluZyA9IHVuZGVmaW5lZDtcclxuICAgIEBJbnB1dCgpIHRoZW1lOiBzdHJpbmcgPSB1bmRlZmluZWQ7XHJcbiAgICBASW5wdXQoKSB2YWx1ZTogbnVtYmVyID0gdW5kZWZpbmVkO1xyXG4gICAgQElucHV0KCkgZHVyYXRpb246IG51bWJlciA9IHVuZGVmaW5lZDtcclxuICAgIEBJbnB1dCgpIGF1dG86IGJvb2xlYW4gPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgLy8gQXZhaWxhYmxlIHRoZW1lc1xyXG4gICAgcHJpdmF0ZSB0aGVtZXM6IEFycmF5PHN0cmluZz4gPSBbXHJcbiAgICAgICAgJ2NhcicsXHJcbiAgICAgICAgJ2RlZmF1bHQnLFxyXG4gICAgICAgICdkaWdpdGFsJyxcclxuICAgICAgICAnbWluaW1hbCcsXHJcbiAgICAgICAgJ3BsYXphJyxcclxuICAgICAgICAnc2xvdC1tYWNoaW5lJyxcclxuICAgICAgICAndHJhaW4tc3RhdGlvbidcclxuICAgIF07XHJcblxyXG4gICAgLy8gU3RhcnQgT2RvbWV0ZXJcclxuICAgIHByaXZhdGUgaW5pdE9kb21ldGVyKCkge1xyXG4gICAgICAgIGlmICghbG9kYXNoLmlzVW5kZWZpbmVkKHRoaXMuY29udGFpbmVyKVxyXG4gICAgICAgICAgICAmJiB0eXBlb2YgT2RvbWV0ZXIgIT09ICd1bmRlZmluZWQnKSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLm9kb21ldGVyID0gbmV3IE9kb21ldGVyKHtcclxuICAgICAgICAgICAgICAgIGVsOiB0aGlzLmNvbnRhaW5lci5uYXRpdmVFbGVtZW50LFxyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0aGlzLmNvbmZpZy5hbmltYXRpb24sXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jb25maWcudmFsdWUsXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5jb25maWcuZHVyYXRpb24sXHJcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IHRoaXMuY29uZmlnLmZvcm1hdCxcclxuICAgICAgICAgICAgICAgIHRoZW1lOiB0aGlzLmNvbmZpZy50aGVtZSxcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWxvZGFzaC5pc1VuZGVmaW5lZCh0aGlzLm51bWJlcikgJiYgdGhpcy5jb25maWcuYXV0bykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vZG9tZXRlci51cGRhdGUodGhpcy5udW1iZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdENvbmZpZygpIHtcclxuICAgICAgICB0aGlzLmNvbmZpZyA9IGxvZGFzaC5kZWZhdWx0cyh0aGlzLmNvbmZpZywgbmV3IFRtTmdPZG9tZXRlckNvbmZpZygpKTtcclxuXHJcbiAgICAgICAgLy8gQW5pbWF0aW9uXHJcbiAgICAgICAgaWYgKCFsb2Rhc2guaXNVbmRlZmluZWQodGhpcy5hbmltYXRpb24pKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRm9ybWF0XHJcbiAgICAgICAgaWYgKCFsb2Rhc2guaXNVbmRlZmluZWQodGhpcy5mb3JtYXQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmZvcm1hdCA9IHRoaXMuZm9ybWF0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVGhlbWVcclxuICAgICAgICBpZiAoIWxvZGFzaC5pc1VuZGVmaW5lZCh0aGlzLnRoZW1lKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy50aGVtZSA9ICFsb2Rhc2guaW5jbHVkZXModGhpcy50aGVtZXMsIHRoaXMudGhlbWUpID8gJ2RlZmF1bHQnIDogdGhpcy50aGVtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFZhbHVlXHJcbiAgICAgICAgaWYgKCFsb2Rhc2guaXNVbmRlZmluZWQodGhpcy52YWx1ZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcudmFsdWUgPSB0aGlzLnZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRHVyYXRpb25cclxuICAgICAgICBpZiAoIWxvZGFzaC5pc1VuZGVmaW5lZCh0aGlzLmR1cmF0aW9uKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5kdXJhdGlvbiA9IHRoaXMuZHVyYXRpb247XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBdXRvXHJcbiAgICAgICAgaWYgKCFsb2Rhc2guaXNVbmRlZmluZWQodGhpcy5hdXRvKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5hdXRvID0gdGhpcy5hdXRvO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVmFsaWRhdGUgdGhlbWUuIElmIG5vdCBwYXJ0IG9mIHRoZVxyXG4gICAgICAgIC8vIGF2YWlsYWJsZSB0aGVtZXMgYXJyYXksIHVzZSB0aGUgZGVmYXVsdFxyXG4gICAgICAgIGlmICghbG9kYXNoLmluY2x1ZGVzKHRoaXMudGhlbWVzLCB0aGlzLmNvbmZpZy50aGVtZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcudGhlbWUgPSAnZGVmYXVsdCc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgLy8gIExJRkVDWUNMRVNcclxuICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5cclxuICAgIHB1YmxpYyBuZ09uSW5pdCgpIHtcclxuXHJcbiAgICAgICAgLy8gQmluZCBPYnNlcnZhYmxlXHJcbiAgICAgICAgaWYgKCFsb2Rhc2guaXNVbmRlZmluZWQodGhpcy5vYnNlcnZhYmxlKSAmJiAhdGhpcy5jb25maWcuYXV0bykge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9IHRoaXMub2JzZXJ2YWJsZS5zdWJzY3JpYmUoKHRyaWdnZXI6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghbG9kYXNoLmlzVW5kZWZpbmVkKHRyaWdnZXIpICYmIHRyaWdnZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9kb21ldGVyLnVwZGF0ZSh0aGlzLm51bWJlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQXBwbHkgZGVmYXVsdHMgYW5kXHJcbiAgICAgICAgLy8gaW5kaXZpZHVhbCBjb25maWd1cmF0aW9uc1xyXG4gICAgICAgIHRoaXMuaW5pdENvbmZpZygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuZ09uRGVzdHJveSgpIHtcclxuICAgICAgICBpZiAoIWxvZGFzaC5pc1VuZGVmaW5lZCh0aGlzLnN1YnNjcmlwdGlvbikpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG5nT25DaGFuZ2VzKCkge1xyXG4gICAgICAgIGlmICghbG9kYXNoLmlzVW5kZWZpbmVkKHRoaXMubnVtYmVyKSAmJiAhbG9kYXNoLmlzVW5kZWZpbmVkKHRoaXMub2RvbWV0ZXIpICYmIHRoaXMuY29uZmlnLmF1dG8pIHtcclxuICAgICAgICAgICAgdGhpcy5vZG9tZXRlci51cGRhdGUodGhpcy5udW1iZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdE9kb21ldGVyKCk7XHJcbiAgICB9XHJcbn1cclxuIl19